export const colorMap: Record<string, string> = {
  "#2a3a33": "#0b0e10",
  "#2a3d3a": "#1d1c1c",
  "#2b3f3c": "#303223",
  "#2c3f3b": "#0e1313",
  "#2e4a4d": "#0e1827",
  "#2f433c": "#0f1516",
  "#304237": "#101416",
  "#314139": "#10161c",
  "#314339": "#121a24",
  "#324238": "#111619",
  "#325253": "#0e1826",
  "#33443a": "#23272d",
  "#342a28": "#0e1116",
  "#34453a": "#10191c",
  "#344e46": "#1c221e",
  "#345559": "#0f1827",
  "#354941": "#20231c",
  "#36473a": "#0f1519",
  "#36473c": "#11191d",
  "#365458": "#0c182b",
  "#365559": "#0d1829",
  "#372d29": "#171716",
  "#37493b": "#161b1a",
  "#374a3d": "#0f1517",
  "#375047": "#151f26",
  "#3a4c3c": "#10161b",
  "#3a554c": "#2f3227",
  "#3b5953": "#3f3e2d",
  "#3b5a5e": "#0e1b2d",
  "#3c5142": "#151c1b",
  "#3c5c5f": "#0e192b",
  "#3c5d60": "#0e1b2c",
  "#3d3e3a": "#2b2626",
  "#3d503f": "#0f1217",
  "#3e4e3e": "#101617",
  "#3e6062": "#0c1627",
  "#405344": "#101217",
  "#423430": "#313137",
  "#425241": "#0f171b",
  "#425343": "#14191b",
  "#425443": "#0f161d",
  "#426264": "#0d192d",
  "#435444": "#10161b",
  "#445644": "#11171d",
  "#446467": "#112133",
  "#455750": "#10171b",
  "#456b6b": "#0e1d32",
  "#465848": "#13191f",
  "#475845": "#121618",
  "#495a48": "#162331",
  "#4a372d": "#12171d",
  "#4a5c4b": "#0f1215",
  "#4a6868": "#0c1729",
  "#4b5945": "#111517",
  "#4c533a": "#1d211d",
  "#4d6c69": "#0e1b2c",
  "#4e614e": "#0f1718",
  "#51392d": "#121312",
  "#51593d": "#14191a",
  "#516e68": "#0e1b2d",
  "#517367": "#19252f",
  "#536147": "#141c1e",
  "#53716d": "#0f1d31",
  "#53756c": "#0c182b",
  "#543b2e": "#14100f",
  "#546958": "#263026",
  "#547168": "#0e1d32",
  "#57756d": "#0e1b2f",
  "#583d2e": "#141314",
  "#585d54": "#2a2e3b",
  "#58796e": "#0d1b2e",
  "#587a70": "#121d2f",
  "#5a6d51": "#252925",
  "#5a7768": "#122433",
  "#5a796f": "#102033",
  "#5a7b71": "#0d1c31",
  "#5b7768": "#112234",
  "#5c664a": "#10191a",
  "#5c796d": "#0e1c31",
  "#5d3f30": "#1d2027",
  "#5d7a6e": "#132533",
  "#5d8075": "#111e30",
  "#5e817a": "#0f1d32",
  "#605e36": "#1e211d",
  "#606b47": "#193353",
  "#61643e": "#1f231e",
  "#617f73": "#0f1d32",
  "#626640": "#181e1f",
  "#627a67": "#132537",
  "#63724e": "#19262b",
  "#638783": "#112037",
  "#646d46": "#18211f",
  "#646e48": "#141b1c",
  "#64888c": "#142b48",
  "#65603b": "#21211d",
  "#656d46": "#222821",
  "#657655": "#12273d",
  "#658987": "#101e39",
  "#66693f": "#1b201f",
  "#677148": "#1d221e",
  "#68724a": "#131a1d",
  "#687b52": "#101719",
  "#688777": "#112239",
  "#698c8f": "#132947",
  "#6a5b45": "#5d4531",
  "#6a7f62": "#1a3039",
  "#6b452e": "#22221e",
  "#6c4932": "#261a15",
  "#6c6d60": "#2f313e",
  "#6c7146": "#1e2321",
  "#6c7853": "#1a2424",
  "#6d9094": "#183053",
  "#6d9193": "#152f50",
  "#6e4b33": "#1d1511",
  "#6e5e4e": "#7d6444",
  "#6e9091": "#122642",
  "#6f482f": "#241c17",
  "#6f4b33": "#2f1f16",
  "#6f9495": "#153156",
  "#706e67": "#272c3c",
  "#707e58": "#3c4240",
  "#724f35": "#2b1c14",
  "#729597": "#17355c",
  "#737644": "#151c1c",
  "#744b30": "#37291e",
  "#74736a": "#242a3b",
  "#749899": "#16355d",
  "#758157": "#1f2e37",
  "#764e31": "#2e221b",
  "#768051": "#1c2422",
  "#76875f": "#192e39",
  "#77835a": "#494539",
  "#787743": "#181e1d",
  "#789b9b": "#17365c",
  "#79756d": "#23293a",
  "#799899": "#142d50",
  "#7b9e9e": "#16345a",
  "#7c786f": "#232939",
  "#7c7e4b": "#1a1e1b",
  "#7c8a61": "#1c2a2d",
  "#7e865c": "#67685f",
  "#808a6e": "#141d22",
  "#815231": "#363023",
  "#819e9f": "#132a4a",
  "#82834e": "#48402a",
  "#829066": "#1c3039",
  "#829067": "#1a2e39",
  "#84926a": "#1c313b",
  "#85a19e": "#132744",
  "#867c71": "#252b3e",
  "#86a6a0": "#143052",
  "#88864f": "#453e2b",
  "#89864e": "#2f3125",
  "#8a6c4f": "#927551",
  "#8a8349": "#222720",
  "#8aaaa1": "#132949",
  "#8ba6a4": "#122848",
  "#8ba9a4": "#142f51",
  "#8c844b": "#282b22",
  "#8c8951": "#2e2e24",
  "#8e5c38": "#202326",
  "#90857a": "#2f3445",
  "#90874b": "#242720",
  "#93aeab": "#18365f",
  "#94894c": "#303123",
  "#957d59": "#42352f",
  "#96866e": "#393033",
  "#968c4d": "#313126",
  "#988d4f": "#3c3826",
  "#995e36": "#2d2b2f",
  "#9a8b7c": "#333646",
  "#9a9050": "#333329",
  "#9b8560": "#4c362b",
  "#9b945a": "#7a6845",
  "#9bb8b4": "#1c3d63",
  "#9c9050": "#3c3a29",
  "#9d5c34": "#1c1d1d",
  "#9d9251": "#53462d",
  "#9e8e7b": "#444756",
  "#a08f7b": "#3b3d4d",
  "#a19380": "#645149",
  "#a29652": "#3e3c31",
  "#a29654": "#755c36",
  "#a2bab0": "#17345b",
  "#a39553": "#624f31",
  "#a4c0bd": "#193b64",
  "#a6c1bd": "#1f4573",
  "#a89957": "#504940",
  "#a9c2bc": "#1a3c67",
  "#aac4c0": "#214878",
  "#aac5c1": "#234873",
  "#ab977f": "#454554",
  "#ab9983": "#403f4e",
  "#acc0b2": "#1a3355",
  "#acc7c3": "#1a3d68",
  "#aec6bf": "#1c3c6a",
  "#b29c7f": "#464654",
  "#b29c81": "#4d4a54",
  "#b2c8c1": "#1c3e6a",
  "#b49c7f": "#494650",
  "#b4c5b7": "#1d3a60",
  "#b79f7c": "#4d4953",
  "#b7c496": "#425f78",
  "#b7c8ba": "#1c3d65",
  "#b9683b": "#b79051",
  "#b9c795": "#334e5f",
  "#baa55c": "#37392b",
  "#bab5a4": "#6c5e4a",
  "#bb986b": "#4e403e",
  "#bbcabd": "#1c385d",
  "#bbcbbf": "#1a3b65",
  "#bc996d": "#453b3c",
  "#bca661": "#514a3a",
  "#bdccbe": "#1c3e68",
  "#c0cb9d": "#335268",
  "#c4c2ac": "#616665",
  "#c5bc9b": "#b88b51",
  "#c6aa7b": "#604d43",
  "#c8d3c5": "#1c3f6c",
  "#c9ad7c": "#5b4a42",
  "#ccd6c9": "#1e4271",
  "#cdb384": "#79624c",
  "#d0d9cc": "#214876",
  "#d2b36c": "#5e4d4a",
  "#d5be91": "#7a6450",
  "#d6bd96": "#715e4f",
  "#d8b27c": "#514443",
  "#d9e1c7": "#294466",
  "#dab25f": "#423c28",
  "#dab47a": "#5a4b40",
  "#dbb57e": "#614d44",
  "#dce0d2": "#2a5280",
  "#ddb67f": "#8f6948",
  "#de8753": "#c77544",
  "#deb87f": "#5b4b40",
  "#e0e3d3": "#254a72",
  "#e1c499": "#b89461",
  "#e1c79c": "#b18f5b",
  "#e2e7d0": "#44668b",
  "#e2e7d3": "#34587d",
  "#e7e8d9": "#525758",
  "#e8e9da": "#58543c",
  "#e9e7db": "#254c7d",
  "#e9ebdc": "#345c88",
  "#eaa052": "#d59f5e",
  "#ead396": "#202725",
  "#eceddf": "#2d4c6e",
  "#ecede0": "#274a73",
  "#f1eee0": "#274f82",
  "#f2efe2": "#0f1316",
  "#f5e8c9": "#6c5d48",
  "#f7cf68": "#dc8d44",
  "#fdf9ed": "#0f1316",
}

/**
 * Convert hex color to RGB object
 */
function hexToRgb(hex: string): { r: number; g: number; b: number } {
  const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex)
  return result
    ? {
        r: Number.parseInt(result[1], 16),
        g: Number.parseInt(result[2], 16),
        b: Number.parseInt(result[3], 16),
      }
    : { r: 0, g: 0, b: 0 }
}

/**
 * Convert RGB object to hex string
 */
function rgbToHex(r: number, g: number, b: number): string {
  return (
    "#" +
    [r, g, b]
      .map((x) => {
        const hex = Math.round(Math.max(0, Math.min(255, x))).toString(16)
        return hex.length === 1 ? "0" + hex : hex
      })
      .join("")
  )
}

/**
 * Interpolate between two colors based on blend factor
 * @param dayColor - The daytime color (hex)
 * @param nightColor - The nighttime color (hex)
 * @param blend - 0 = full day, 1 = full night
 */
function lerpColor(dayColor: string, nightColor: string, blend: number): string {
  const day = hexToRgb(dayColor)
  const night = hexToRgb(nightColor)

  const r = day.r + (night.r - day.r) * blend
  const g = day.g + (night.g - day.g) * blend
  const b = day.b + (night.b - day.b) * blend

  return rgbToHex(r, g, b)
}

/**
 * Apply blended color mapping to an SVG string based on time of day.
 *
 * @param svg - The SVG markup as a string
 * @param blend - Blend factor: 0 = full day (original colors), 1 = full night (mapped colors)
 * @returns A new SVG string with blended colors
 */
export function applyColorMapping(svg: string, blend: number): string {
  // Clamp blend between 0 and 1
  const clampedBlend = Math.max(0, Math.min(1, blend))

  // If fully daytime, return original SVG
  if (clampedBlend === 0) {
    return svg
  }

  return svg.replace(/#[0-9a-fA-F]{3,6}/g, (match) => {
    // Normalize to 6-digit lowercase hex
    const normalized =
      match.length === 4 ? "#" + match[1] + match[1] + match[2] + match[2] + match[3] + match[3] : match.toLowerCase()

    const nightColor = colorMap[normalized]

    // If no mapping exists, return original color
    if (!nightColor) {
      return match
    }

    // If fully nighttime, return night color directly
    if (clampedBlend === 1) {
      return nightColor
    }

    // Blend between day and night colors
    return lerpColor(normalized, nightColor, clampedBlend)
  })
}

/**
 * Calculate blend factor based on sun altitude
 * @param sunAltitudeDeg - Sun altitude in degrees
 * @returns Blend factor: 0 = day, 1 = night
 */
export function calculateBlendFactor(sunAltitudeDeg: number): number {
  // Full day: sun > 6° above horizon
  if (sunAltitudeDeg > 6) {
    return 0
  }
  // Full night: sun < -12° below horizon
  if (sunAltitudeDeg < -12) {
    return 1
  }
  // Transition zone: -12° to 6° (18° range)
  // Linear interpolation from 1 (at -12°) to 0 (at 6°)
  return 1 - (sunAltitudeDeg + 12) / 18
}
